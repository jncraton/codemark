<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <title></title>
    <style>
      textarea {
        width: 80ch;
        height: 20em;
      }
      section {
        display: inline-block;
      }
      section.wholerow {
        display: block;
      }
      section > label {
        display: block;
      }
    </style>
  </head>

  <body>
    <label><input id="spaces" type="checkbox" checked />Tabs to Spaces</label>
    <label><input id="whitespace" type="checkbox" checked />Vary Spaces</label>
    <label><input id="strings" type="checkbox" />Corrupt Strings</label>
    <label><input id="bold" type="checkbox" />Bold keywords</label>

    <section class="wholerow">
      <label for="src">Input</label>
      <textarea id="src"></textarea>
    </section>

    <section style="display: inline-block">
      <label for="corrupted">Corrupted</label>
      <textarea id="corrupted"></textarea>
    </section>

    <section style="display: inline-block">
      <label for="repaired">Repaired</label>
      <textarea id="repaired"></textarea>
    </section>

    <script>
      const letters = 'abcdefghijklmnopqrstuvwxyz'
      const bold_letters = '𝐚𝐛𝐜𝐝𝐞𝐟𝐠𝐡𝐢𝐣𝐤𝐥𝐦𝐧𝐨𝐩𝐪𝐫𝐬𝐭𝐮𝐯𝐰𝐱𝐲𝐳'

      function render() {
        repaired.value = src.value
        repaired.value = repaired.value.replaceAll('\u00A0', '')
        repaired.value = repaired.value.replaceAll('\u2002', '')
        repaired.value = repaired.value.replaceAll('\u2003', '')
        repaired.value = repaired.value.replaceAll('ᅟ', '')

        Array.from(bold_letters).forEach((l, i) => {
          repaired.value = repaired.value.replaceAll(l, letters[i])
        })

        corrupted.value = src.value

        // Replace tabs with spaces
        if (spaces.checked)
          corrupted.value = corrupted.value.replaceAll('\t', '    ')

        // Replace 4-space indents with alternate whitespace:
        // U+00A0 NO-BREAK SPACE
        // U+2002 EN SPACE
        // U+2003 EM SPACE
        if (whitespace.checked)
          corrupted.value = corrupted.value.replaceAll(
            '    ',
            '\u00A0 \u2002\u2003',
          )

        // Add an invisible Hangul Choseong Filler at the end of strings
        if (strings.checked)
          corrupted.value = corrupted.value.replaceAll('"', '"ᅟ')

        // Bold certain keywords using unicode math characters
        if (bold.checked) {
          corrupted.value = corrupted.value.replaceAll('def', '𝐝𝐞𝐟')
          corrupted.value = corrupted.value.replaceAll('if', '𝐢𝐟')
          corrupted.value = corrupted.value.replaceAll('elif', '𝐞𝐥𝐢𝐟')
          corrupted.value = corrupted.value.replaceAll('else', '𝐞𝐥𝐬𝐞')
        }
      }

      src.addEventListener('input', render)
      document
        .querySelectorAll('input')
        .forEach(e => e.addEventListener('input', render))
      render()
    </script>
  </body>
</html>
